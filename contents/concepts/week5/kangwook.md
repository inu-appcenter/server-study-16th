# 📌 Github Actions

**Github Actions** 란 **빌드, 테스트 그리고 배포 파이프라인을 자동화 할 수 있는 CI/CD(지속적 통합 및 지속적 배포) 플랫폼이다**. 

*저장소(Repository)에 대한 모든 pull request를 빌드 및 테스트 하거나 프로덕션에 pull request 해서 배포하는 워크플로우(Workflow)를 만들 수 있다.*

단순히 Issue가 생성되었을 때 적절한 label을 등록하는 등의 단순한 워크플로우도 작성해볼 수 있다.

여러 CI/CD를 위한 제품이 많이 출시되어 있지만, GitHub Actions는 GitHub 자체에서 지원하므로 **GitHub과 함께 사용할 때 그 사용성이 매우 매끄럽다**. 

또한, 물론 어느 정도 제한이 있지만 컴퓨팅 리소스를 GitHub에서 제공해주며, **무료**로(public 저장소 기준) 사용할 수 있기 때문에 개인 토이 프로젝트를 진행할 때 자주 사용한다.

&nbsp;
# 📌 Workflow란?

***워크플로우(Workflow)** 란 **프로세스에서 완료해야 하는 일련의 단계**를 의미한다.*

pull request가 열렸을 때나 이슈(issue)가 생성되었을 때처럼 저장소에서 이벤트(event)가 발생했을 때, Github Actions 워크플로우가 ***트리거(작동)*** 되도록 설정할 수 있다.

이 워크플로우에는 순차적 또는 병렬로 실행 될 수 있는 **job**이 1개 이상 들어있다.

각 job은 자체 가상 머신 러너 또는 컨테이너 내부에서 실행되며, *정의한 스크립트를 실행*하거나 ***액션(action)** 을 실행하는 하나 이상의 단계*가 있습니다.

가장 큰 순서대로 표현하면 workflow > job > action 이런 순서대로 진행하며 하나의 워크플로우에 여러 잡이 존재하고 잡 안에 여러 액션이 존재하게 되는 것이다.

&nbsp;
## Workflow

워크플로우는 쉽게 말해 자동화해놓은 작업 과정이라고 볼 수 있다.

워크플로우는 저장소 안에 **YAML 파일**을 통해 정의되며, *저장소 이벤트에 의해 트리거될 때 실행*되거나 *수동으로 또는 정의된 일정에 따라 트리거 될 수 있다.*

워크플로우는 *저장소 내*에 **.github/workflow 디렉토리** 안에 정의하며 하나의 저장소에 여러개의 워크플로우를 가질 수 있다. 각각의 워크플로우는 서로 다른 작업을 수행할 수 있다.

예를 들어,

한 워크플로우에는 빌드와 테스트 pull request를 수행하고,

다른 워크플로우에는 릴리즈가 생성될 때 마다 애플리케이션 배포,

또 다른 워크플로우에는 누군가 새로운 이슈를 open 하면 label 을 추가

할 수 있도록 할 수 있다.

이 워크플로우 YAML 파일에는 크게 2가지를 정의해야하는데요. 첫번째는 `on` 속성을 통해서 해당 워크플로우가 언제 실행되는지를 정의한다.

예를 들어, 코드 저장소의 `main` 브랜치에 `push` 이벤트가 발생할 때 마다 워크플로우를 실행하려면 다음과 같이 설정해준다.

```jsx
on: 
 push:   
  branches: [main]

jobs:
 
```

두번째는 `jobs` 속성을 통해서 해당 워크플로우가 구체적으로 어떤 일을 해야하는지 명시해야한다.

&nbsp;
## event

이벤트는 **워크플로우 실행을 트리거하는 저장소의 특정 활동이**다.

예를 들어,

누군가 저장소에 pull request를 생성하거나,

이슈를 열거나,

커밋을 푸시할 때 처럼

이벤트가 Github에서 시작될 수 있다.

&nbsp;
## jobs

GitHub Actions에서 작업(Job)이란 독립된 가상 머신(machine) 또는 컨테이너(container)에서 돌아가는 하나의 처리 단위를 의미한다.

하나의 워크플로우는 여러 개의 작업으로 구성되며 적어도 하나의 작업은 있어야 한다. 

그리고 모든 작업은 기본적으로 동시에 실행되며, 필요 시 작업 간에 의존 관계를 설정하여 작업이 실행되는 순서를 제어할 수도 있다.

작업은 워크플로우 YAML 파일 내에서 `jobs` 속성을 사용하며 작업 식별자(ID)와 작업 세부 내용 간의 맵핑(mapping) 형태로 명시가 된다.

예를 들어, `job1`, `job2`, `job3`이라는 작업 ID를 가진 3개의 작업을 추가하려면 다음과 같이 설정한다.

```jsx

jobs:  
	job1:    # job1에 대한 세부 내용  
	job2:    # job2에 대한 세부 내용  
	job3:    # job3에 대한 세부 내용
```

작업의 세부 내용으로는 여러 가지 내용을 명시할 수 있다. 

필수로 들어가야 하는 `runs-on` 속성을 통해 해당 리눅스나 윈도우즈와 같은 실행 환경을 지정해줘야 한다.

예를 들어, 가장 널리 사용되는 우분투의 최신 실행 환경에서 해당 작업을 실행하고 싶다면 다음과 같이 설정한다.

```yaml

jobs:
  job1: 
    runs-on: ubuntu-latest
    steps:
      # ...(생략)...
```

작업에서 가장 중요한 부분은 작업 순서를 정의하는 것이다.

이 부분은 `steps` 속성을 통해서 설정을 한다.

&nbsp;
## Steps

정말 단순한 작업이 아닌 이상 하나의 작업은 일반적으로 여러 단계의 명령을 순차적으로 실행하는 경우가 많다. 

그래서 GitHub Actions에서는 각 작업(job)이 하나 이상의 단계(step)로 모델링이 된다.

작업 단계는 단순한 커맨드(command)나 스크립트(script)가 될 수도 있고 좀 더 복잡한 명령인 액션일 수도 있다. 

커맨드나 스크립트를 실행할 때는 `run` 속성을 사용하며, 액션을 사용할 때는 `uses` 속성을 사용한다.

예를 들어,  자바스크립트 프로젝트에서 테스트를 돌리려면

1. 코드 저장소에 코드를 작업 실행 환경으로 내려 받고,

2. 패키지를 설치한 후,

3. 테스트 스크립트를 실행해야 한다.

이 3단계의 작업은 아래와 같이 `steps` 속성을 통해서 명시될 수 있다.

```yaml
jobs:
  test:
    runs-on: ubuntu-latest
    steps:      
    - uses: actions/checkout@v3     
    - run: npm install      
    - run: npm test
```

워크플로우 파일 내에서 작업 단계를 명시해줄 때는 주의할 부분이 있다.

YAML 문법에서 시퀀스(sequence) 타입을 사용하기 때문에 각 단계 앞에 반드시 `-`를 붙여줘야 합니다.

&nbsp;
## Actions

복잡하지만 자주 사용되는 작업 단위를 재사용이 가능하도록 만든 실행 단위이다. 

액션은 GitHub Marketplace에서 공유될 수 있다. 또한 다른 사용자들이 자신의 워크플로우에 다른 사람들이 만든 액션을 가져와 사용할 수 있다.

대표적인 액션으로는 **`actions/checkout`** 이 있는데, 이 액션은 러너에 저장소 코드를 다운로드하고 특정 브랜치로 Checkout 하는 작업을 해준다. 

거의 대부분의 CI/CD 작업에는 프로젝트의 소스코드가 필요하므로 정말 많이 사용되는 액션이라고 할 수 있다.

&nbsp;
## Runner

러너는 GitHub Actions 워크플로우를 실제로 실행하는 서버를 의미한다. 

GitHub에서는 Ubuntu, Windows, macOS 환경의 러너를 제공한다.

&nbsp;
## 워크플로우 작성 예시

```yaml
name: Backend CI # 1
on: # 2
  pull_request: # 3
    branches: [develop]
jobs: # 4
  build: # 5
    runs-on: ubuntu-latest # 6
    steps: # 7
      - uses: actions/checkout@v3 # 8
      - run: "./gradlew build" # 9
```

1. 워크플로우의 이름을 정의한다.
2. 워크플로우가 트리거될 이벤트를 정의한다.
3. **`pull_request`** 는 PR이 생성되었을 때 실행되게끔 해주는 이벤트이다. **`branches`** 프로퍼티를 사용하여 브랜치를 제한할 수 있다.
4. 작업들을 정의한다.
5. 작업의 이름이다.
6. 작업이 실행될 환경을 정의한다.
7. 작업의 단계를 정의한다.
8. 액션을 사용할 때에는 예제와 같이 **`uses`** 를 사용한다.
9. 단순한 커맨드를 실행한다. Gradle을 사용하여 스프링부트 프로젝트를 빌드하도록 한다.
