# 5주차_테스트와 테스트 주도 개발

생성일: 2024년 5월 20일 오후 2:28
태그: 서버 스터디

- 테스트와 테스트 주도 개발
    - 테스트란? (단위 테스트와 통합 테스트)
    - 테스트 주도 개발이란?

# 테스트

### 테스트란?

> *테스트를 소프트웨어의 관점에서 정의하면 "애플리케이션이 요구 사항에 맞게 동작하는 지를 검증하는 행위" 라고 할 수 있다.*
> 

테스트 주도 개발이 대중화 되면서, 테스트는 점점 더 개발 단계의 일부로 받아 들여지고 있다.

여기서 말하는 테스트는 주로 코드로 작성된 **자동화 테스트**를 말한다.

개발자가 테스트 코드를 직접 작성하게 되면 더 적극적으로 코드 개선(리팩토링 등)을 할 수 있어 코드 품질이 향상된다.

또한 개발 단계에서 제품 품질이 향상되어 테스터와의 불필요한 커뮤니케이션 비용이 감소하게 된다.

테스트에는 다양한 종류가 있으며, 개발자의 관점에서는 보통 범위에 따른 구분을 많이 사용한다.

범위에 따라 크게 **단위 테스트**, **통합 테스트**, **시스템 테스트**로 구분할 수 있다. 

### 단위 테스트(Unit Test)

> *단위 테스트는 하나의 모듈을 기준으로 독립적으로 진행되는 가장 작은 단위의 테스트이다.*
> 

여기서 모듈은 어플리케이션에서 작동하는 하나의 기능 또는 메서드로 볼 수 있다.

단위 테스트는 어플리케이션을 구성하는 하나의 기능이 올바르게 동작하는 지를 독립적으로 테스트하는 것으로, “어떤 기능이 실행되면 어떤 결과가 나온다” 정도로 테스트를 진행한다.

단위 테스트에서 테스트 대상 단위의 크기는 엄격하게 정해져 있지는 않다. 일반적으로는 클래스 또는 메서드 수준으로 정해지며, 단위의 크기가 작을수록 단위의 복잡성이 낮아진다.

즉, 테스트 대상 단위의 크기를 작게 설정해서 단위 테스트를 최대한 간단하고 디버깅하기 쉽게 작성해야 한다.

### 통합 테스트(Integration Test)

> *통합 테스트(Integration Test)는 모듈을 통합하는 과정에서 모듈 간의 호환성을 확인하기 위해 수행되는 테스트이다.*
> 

일반적으로 어플리케이션은 여러 개의 모듈들로 구성이 되고, 모듈들끼리 메시지를 주고 받으면서(함수 호출) 기능을 수행한다. 

통합 테스트는 단위 테스트와 달리 개발자가 변경할 수 없는 부분(ex. 외부 라이브러리)까지 묶어 검증할 때 사용한다. 

이는 DB에 접근하거나 전체 코드와 다양한 환경이 제대로 작동하는지 확인하는데 필요한 모든 작업을 수행할 수 있다.

그러나, 통합 테스트가 응용 프로그램이 완전하게 작동하는 걸 무조건 증명하지는 않는다.

### 시스템 테스트(System Test)

> *시스템 테스트는 전체 시스템 혹은 어플리케이션을 전체적으로 평가하는 테스트이다.*
> 

통합한 모듈들이 요구 사항에 잘 맞게 작동되는 지를 판단하며, 의도한 환경에서 올바르게 작동하는지 확인한다.

또한 작동 시간, 처리 능력, 부하, 복구 등과 같은 비 기능적 요소들도 점검한다.

보통 통합 테스트 후, 인수 테스트 전에 진행된다.

모든 컴포넌트, 모듈 및 외부 시스템 (DB, API, 타사 서비스)을 포함하여 시스템을 E2E (End to End)로 테스트하는 작업이 포함된다.

시스템 테스트는 실제 운영 환경과 매우 유사한 별도의 테스트 환경에서 주로 수행된다.

### 인수 테스트(Acceptance Test)

> *인수 테스트는 사용자 스토리(시나리오)에 맞춰 수행하는 테스트이다.*
> 

인수 테스트는 위 테스트들과 달리 비즈니스 쪽에 초점을 둔다.

프로젝트에 참여하는 사람들(ex. 기획자, 클라이언트 대표, 기획자 등)이 토의해서 시나리오를 만들고, 개발자는 이에 의거해서 코드를 작성한다.

개발자가 시나리오를 제작할 수도 있지만, 인수 테스트 자체가 “다른 의사소통집단으로부터 시나리오를 받아(인수) 개발한다”는 의미를 가지고 있다.

인수 테스트는 애자일 개발 방법론에서 파생했다.

시나리오가 정상적으로 동작하는 지를 테스트하기 때문에 통합 테스트와는 분류가 다르다.

시나리오에서 요구하는 것은 *누가, 어떤 목적으로, 무엇을 하는가* 이다. 

이런 기능은 보통 API를 통해 드러나므로 인수 테스트는 주로 API를 확인하는 방식으로 이루어진다.

Java에서는 `RestAssuerd` , `MockMvc` 같은 도구를 활용하여 작성할 수 있다

```java
public static ExtractableResponse<Response> 회원_생성_요청(MemberRequest memberRequest) {
    return RestAssured
            .given()
            .contentType(MediaType.APPLICATION_JSON_VALUE)
            .body(memberRequest)
            .when().post("/api/members")
            .then()
            .extract();
}
```

### 단위 테스트 vs 통합 테스트

통합 테스트는 실제 여러 컴포넌트들 간의 상호작용을 테스트하기 때문에 모든 컴포넌트들이 구동된 상태에서 테스트를 하게 된다. 

그렇기에 통합 테스트를 위해서는 캐시나 데이터베이스 등 다른 컴포넌트들과 실제 연결을 해야하고, 시스템을 구성하는 컴포넌트들이 많아질수록 테스트를 위한 비용(시간)이 상당히 커진다.

반면 단위 테스트는 해당 부분만 독립적으로 테스트하기 때문에 어떤 코드를 수정하여도 빠르게 문제 여부를 확인할 수 있다.

즉, 테스팅에 대한 시간과 비용을 절감할 수 있고, 
새로운 기능 추가 혹은 리팩토링 시에 수시로 빠르게 테스트할 수 있으며,
테스트 코드가 해당하는 코드에 대한 문서가 될 수 있다.

때문에 실무에서는 단위  테스트를 선호하며, 요즘 많이 사용되는 TDD(테스트 주도 개발)에서 말하는 테스트도 단위 테스트를 의미한다.

# 테스트 주도 개발

### TDD(Test Driven Developmet)란?

> *TDD 는 반복 테스트를 이용한 소프트웨어 방법론으로, 작은 단위의 테스트 케이스를 작성하고 이를 통과하는 코드를 추가하는 단계를 반복하여 구현한다.*
> 

테스트 주도 개발은 짧은 주기의 반복에 의존하는 개발 프로세스이며,
애자일 방법론 중 하나인 eXtream Programming(XP)의 ‘Test-First’ 개념에 기반을 둔 단순한 설계를 중요시한다.

### **TDD 개발 주기**

![img1 daumcdn](https://github.com/inu-appcenter/server-study-16th/assets/86196038/530af7b5-7679-4803-b98e-6d824c2d63a8)

Red 단계에서는 실패하는 테스트 코드를 먼저 작성한다.   

Green 단계에서는 테스트 코드를 성공시키기 위한 실제 코드를 작성한다.   

Blue 단계에서는 중복 코드 제거, 일반화 등의 리팩토링을 수행한다.

중요한 것은 **실패하는 테스트 코드를 작성할 때까지 실제 코드를 작성하지 않는 것**과, **실패하는 테스트를 통과할 정도의 최소 실제 코드를 작성해야 하는 것**이다.

![img1 daumcdn 1](https://github.com/inu-appcenter/server-study-16th/assets/86196038/09d47035-72ca-4ccb-bd27-67d251b255f2)

### TDD의 효과

1. **디버깅 시간을 단축할 수 있다**

이는 단위 테스트를 하는 이점과 동일하다.

1. **코드가 내 손을 벗어나기 전에 가장 빠르게 피드백을 받을 수 있다**

개발 프로세스에서는 보통 ‘인수 테스트’를 하는데, 이미 90% 이상 완성된 코드로 진행한 테스트에서 문제를 발견해도, 정확한 원인 진단이 어렵다.

TDD를 사용하면 기능 단위로 테스트하기 때문에 코드가 모두 완성되어 개발자의 손을 떠나기 전에 피드백을 받는 것이 가능하다.

1. **작성한 코드가 가지는 불안정성을 개선하여 생산성을 높일 수 있다**

앞서 말한 대로 코드가 내 손을 떠나 사용자에게 도달하기 전에 문제 여부를 확인할 수 있기 때문에, 코드가 지닌 불안정성과 불확실성을 지속적으로 해소해준다.

1. **추가 구현이 용이하다**

개발이 완료된 소프트웨어에 어떤 기능을 추가할 때 가장 우려되는 점은 해당 기능이 기존 코드에 어떤 영향을 알지 못한다는 것이다.

TDD의 경우 자동화된 단위 테스팅을 전제하므로 테스트 기간을 획기적으로 단축 시킬 수 있다.

### TDD의 단점

1. **가장 큰 단점은 바로 생산성의 저하이다**

처음부터 2개의 코드를 짜며, 중간중간 테스트를 진행하며 고쳐나가야 하기 때문이다.

TDD 방식의 개발 시간은 일반적인 개발 방식에 비해 대략 10~30% 정도로 늘어난다.

1. **이제까지의 개발 방식을 많이 바꾸어야한다**

개발하는 방식이 기존 방식에서 상당히 바뀌기 때문에 몸에 체득한 방식을 바꾸는 것이 어려울 수 있다.

1. **구조에 얽매인다**

TDD로 프로젝트를 진행하다 보면 어려운 예외가 생길 수 있는데, 테스트 원칙을 지키고자 실제 코드를 작성하지 못하는 상황이 발생하게 된다.